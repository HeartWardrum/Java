# 2023年8月7日

## JSP

前后端混合编写的技术

前端代码使用HTML编写，后端的Java代码写在`<% %>`中

JSP技术必须写在后缀名是.jsp的文件中

~~~html
<html>
  <head>
    <title>这是我的第一个Jsp网页</title>
  </head>
  <body>
  hello
   <%
     System.out.println("hello jsp");
   %>
  </body>
</html>
~~~

当我们编写好JSP文件，随着Tomcat启动，它会自动翻译出一个Servlet，并执行
所以JSP的本质是一个Servlet
JSP是后端技术

## 将字符串打印到页面

1. `out.print("字符串)`
2. `<%="字符串"%>`

~~~html
<html>
  <head>
    <title>这是我的第一个Jsp网页</title>
  </head>
  <body>
  hello
   <%
     out.println("1");
   %>
  <%="2"%>
  </body>
</html>

~~~

## JSP九大隐含对象

**隐含对象**：在JSP中无序定义可以直接使用的对象

out ---- JspWriter类的对象，可以打印字符串到网页上

request ---- HttpServletRequest类的对象，表示当前请求

response ---- HttpServletResponse类的对象，表示当前响应

pageContext ---- PageContext类的对象，表示当前页面上下文，它可以获取其他八位的对象

session ---- HttpSession类的对象，表示当前会话，会话指的是一次浏览器的打开到关闭的过程

application ---- ServletContext类的对象，是Servlet的大管家

config ---- 当前JSP翻译出的哪个Servlet类的ServletConfig对象

page ---- 当前JSP翻译出来的哪个Servlet类的对象

exception ---- 当前JSP抛出的异常对象

#### ChatGPT:

JSP（JavaServer Pages）中有九个隐含对象，它们是预先定义好的变量，开发人员可以在JSP页面中直接使用，用于访问与请求、会话、上下文等相关的信息。以下是这九个隐含对象的列表和简要说明：

1. **request（请求对象）**：表示当前HTTP请求的对象，可以用于获取请求参数、头信息等。

2. **response（响应对象）**：表示当前HTTP响应的对象，可以用于设置响应头、写入响应内容等。

3. **out（输出对象）**：用于向客户端浏览器输出内容，类似于`System.out`，但用于输出到浏览器。

4. **session（会话对象）**：表示用户的会话，可以用于在不同请求之间存储和获取用户的数据。

5. **application（应用上下文对象）**：表示整个Web应用程序的上下文信息，可以用于在不同会话之间共享数据。

6. **config（配置对象）**：表示JSP页面的配置信息，例如JSP的初始化参数。

7. **pageContext（页面上下文对象）**：表示JSP页面的上下文信息，包括其他隐含对象和一些有用的方法。

8. **page（页面对象）**：表示JSP页面本身的对象，相当于Java类的this。

9. **exception（异常对象）**：用于捕获页面中发生的异常，并进行相应的处理。

这些隐含对象在每个JSP页面中都是自动可用的，开发人员可以直接在页面中使用它们，从而方便地访问与请求、会话、上下文等相关的信息，实现更丰富的功能。

-------------

index.jsp表示首页,它的文件名可以不写就直接展示

~~~jsp
<html>
<head>
    <title>MyFirstJSP</title>
</head>
<body>
This is my first JSP

<%
String age = request.getParameter("age");
out.print("age = " + age);
int ageInt = Integer.valueOf(age);
if(ageInt >= 18){
    out.print("您已经成年了");
}else{
    out.print("未成年人禁止访问");
}
%>

</body>
</html>
~~~

**注意**：在同一个JSP文件中，各个JSP代码块是想通的

~~~jsp
<html>
<head>
    <title>MyFirstJSP</title>
</head>
<body>
This is my first JSP

<%
String age = request.getParameter("age");
%>
<br/>
<%
out.print("age = " + age);
%>
<br/>
<%
int ageInt = Integer.valueOf(age);
if(ageInt >= 18){
%>
您已经成年了
<%
}else{
%>
未成年爬！
<%
}
%>

</body>
</html>
~~~

注释：

`<%-- --%>`

## 四大域对象

pageContext

request

session

application

他们可以分别进行存值和取值的操作

存值 ---- setAttribute("键"，"值")

取值 ---- getAttribute("键"，"值")

删除值 ---- removeAttribute("键"，"值")

**作用范围**：

pageContext ---- 当前页面

request ---- 一次请求

session ---- 一次会话，浏览器的打开到关闭称为一次会话

application ---- 当前web应用，tomcat的启动到关闭

**注意**：实际开发中，用的最多的是request

~~~jsp
<html>
<head>
    <title>MyFirstJSP</title>
</head>
<body>
This is my first JSP

<%

    pageContext.setAttribute("pageKey", "pageValue");
    request.setAttribute("reqKey", "reqValue");
    session.setAttribute("sessionKey", "SessionValue");
    application.setAttribute("applicationKey", "applicationValue");
%>

<%=pageContext.getAttribute("pageKey")%>
<br/>
<%=request.getAttribute("reqKey")%>
<br/>
<%=session.getAttribute("sessionKey")%>
<br/>
<%=application.getAttribute("applicationKey")%>
<br/>

<a href="mySecondJSP.jsp">跳转到第二个页面</a>
</body>
</html>
~~~

~~~jsp
<html>
<head>
    <title>Title</title>
</head>
<body>
第二个页面
<br/>
<%=pageContext.getAttribute("pageKey")%>
<br/>
<%=request.getAttribute("reqKey")%>
<br/>
<%=session.getAttribute("sessionKey")%>
<br/>
<%=application.getAttribute("applicationKey")%>
<br/>
</body>
</html>
~~~

## 请求转发

1. 采用当前request对象调用getResponseDispatcher(路径)得到RequestDispatcher对象
2. 通过RequestDispatcher对象调用 forward(request,response)完成转发

~~~java
public class TestForward extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("来了个请求，即将转发去下一个页面");
        //转发去下一个页面
        String path = "/test2.jsp";
        //获取转发器
        RequestDispatcher requestDispatcher = req.getRequestDispatcher(path);
        requestDispatcher.forward(req,resp);//完成转发

    }
}
~~~

~~~xml
    <servlet>
        <servlet-name>testForward</servlet-name>
        <servlet-class>com.iweb.TestForward</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>testForward</servlet-name>
        <url-pattern>/testForward</url-pattern>
    </servlet-mapping>
~~~

~~~jsp
<html>
<head>
    <title>Title</title>
</head>
<body>
test1

<a href="testForward">to test2.jsp</a>

</body>
</html>
~~~

~~~jsp
<html>
<head>
    <title>Title</title>
</head>
<body>
test2
</body>
</html>
~~~

##  重定向

通过HttpServletResponse对象调用sendRedirect(路径)即可

~~~java
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("即将重定向去下一个页面");
        String path = "/test20230807/test2.jsp";
        resp.sendRedirect(path);

    }
~~~

### 面试题：请求转发和重定向的区别

**本质区别**：

转发在转发前和转发后是同一个请求
重定向在重定向前后是两个不同的请求

**细节上的区别**：

1. 路径中的斜杠含义不同，转发的时候，斜杠表示web应用根目录，重定向的时候，表示web站点根目录
2. url地址栏的显示不同，转发的时候，显示的是初次发起的请求名，重定向的时候，显示的是最终到达的目标资源
3. 转发的时候可以使用request对象携带数据，重定向是时候不可以使用request对象携带数据
4. 转发只能转到当前web应用以内的资源，重定向可以重定向到任何资源

**注意**：转发和重定向不仅可以跳转到页面，还可以向下一个Servlet发送请求

~~~java
public class TestResult extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("我是测试servlet");

    }
}
~~~

~~~xml
    <servlet>
        <servlet-name>testResult</servlet-name>
        <servlet-class>com.iweb.TestResult</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>testResult</servlet-name>
        <url-pattern>/testResult</url-pattern>
    </servlet-mapping>
~~~

~~~java
public class TestForward extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("来了个请求，即将转发去下一个页面");
        //转发去下一个页面
        //String path = "/test2.jsp";
        String path = "/testResult";

        req.setAttribute("key01","value01");
        //获取转发器
        RequestDispatcher requestDispatcher = req.getRequestDispatcher(path);
        requestDispatcher.forward(req,resp);//完成转发

    }
}
~~~

## 关于路径的问题

在web.xml中，`<url-pattern>`的斜杠/表示web应用的根目录，我们发起请求所写的路径必须和该路径一致，

在页面上`<a>`和`<form>`中的斜杠/表示web站点的根目录

~~~jsp
<html>
<head>
    <title>Title</title>
</head>
<body>
我是d1下的test1
<a href="/test20230807/testForward">请求转发</a>
<a href="/test20230807/testRedirect">重定向</a>
</body>
</html>
~~~

## errorPage属性

当前页面如果报错，则跳转到某个提示页面

~~~jsp
<%@ page contentType="text/html;charset=UTF-8" errorPage="error.jsp" language="java" %>
<html>
  <head>
    <title>这是我的第一个Jsp网页</title>
  </head>
  <body>
 <%
   int i = 0;
 %>
  <%=100/i%>
  </body>
</html>

~~~

~~~jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Error</title>
</head>
<body>
对不起，系统正在维护
</body>
</html>
~~~

isErrorPage="true" ---- 表示当前页面可以使用exception隐含对象展示简要的错误信息

## `<%@include file="目标页面"%>`

将目标JSP合并到当前JSP中

~~~jsp
<%@ page contentType="text/html;charset=UTF-8" errorPage="error.jsp" language="java" %>
<%@include file="error.jsp"%>
<html>
  <head>
    <title>这是我的第一个Jsp网页</title>
  </head>
  <body>
这里是index.jsp
  </body>
</html>

~~~

## 参数中的中文乱码问题

在接收请求参数之前，首先使用request对象，调用setCharacterEncoding("utf-8")，完成转码

~~~jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>test3</title>
</head>
<body>
This is test3.jsp

<br/>
<form action="<%=request.getContextPath()%>/test3" method="post">
    <input type="text" name="username"/>
    <br/>
    <input type="submit" value="提交"/>
</form>
</body>
</html>
~~~

~~~java
public class Test3 extends HttpServlet {

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf-8");
        System.out.println("我是post请求");
        String str = req.getParameter("username");
        System.out.println(str);
    }
}
~~~

~~~xml
    <servlet>
        <servlet-name>test3</servlet-name>
        <servlet-class>com.iweb.Test3</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>test3</servlet-name>
        <url-pattern>/test3</url-pattern>
    </servlet-mapping>
~~~





