# 7-1

律师律所接收数据定时器功能修复

# 7-2

律师律所接收数据定时器功能修复

#### 遇到的问题

hibernate的listAll()查询超过两万条数据的时候可能会报错和自动回滚，需要手写SQL，select必要的字段，来优化查询

# 7-4

业务要求必须使用HttpServletRequest来接收MultipartFile文件，

遇到的问题：无法提取出MultipartFile文件

解决方法：https://blog.csdn.net/qq_34039868/article/details/89957414

关键代码：

~~~java
@RequestMapping(value = "/fileUpload")
    @ResponseBody
    public void fileUpload(HttpServletRequest request) {
        //将request强转，因为拦截过后request的实际类型是DefaultMultipartHttpServletRequest 
        DefaultMultipartHttpServletRequest fileRequest = (DefaultMultipartHttpServletRequest)request;
        //获取文件Map
        MultiValueMap<String, MultipartFile> fileMap = fileRequest.getMultiFileMap();
        //遍历所有的文件，每个List<MultipartFile>代表一个文件，get(0)就可以了
        for(Map.Entry<String, List<MultipartFile>> entry : fileMap.entrySet()){
            List<MultipartFile> value = entry.getValue();
            MultipartFile multipartFile = value.get(0);
            try {
                service.fileUpload(multipartFile.getBytes());    //将文件二进制上传到磁盘或数据库
            } catch (IOException e) {
                e.printStackTrace();
            }
    }
~~~

